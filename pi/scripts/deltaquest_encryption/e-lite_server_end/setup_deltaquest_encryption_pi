https://charlesreid1.com/wiki/RaspberryPi/SSH_Stunnel
# This script is to run on an e-lite server in order enable stunnel ssh keys passwordless login

# Enable Ipv4 forwarding at boot
sed -i '20 a echo 1 > /proc/sys/net/ipv4/ip_forward' /etc/rc.local

# Generate ssh keys
openssl genrsa -out key.pem 2048

# Generate a Self-Signed Certificate
openssl req -new -x509 -key key.pem -out cert.pem -days 14600

# Copy the keys into stunnel configuration
cat key.pem cert.pem >> /etc/stunnel/stunnel-deltaquest.pem
chmod 400 /etc/stunnel/stunnel-deltaquest.pem

# Get the Stunnel config file
/usr/bin/wget --no-check-certificate 'https://raw.githubusercontent.com/LoneFreeRanger/esp/main/pi/scripts/deltaquest_encryption/e-lite_server_end/stunnel.conf' -O /etc/systemd/system/stunnel.conf

# Populate it with the following:
output = /var/log/stunnel4/stunnel-deltaquest.log
cert = /etc/stunnel/stunnel-deltaquest.pem
key = /etc/stunnel/stunnel-deltaquest.pem
pid = /var/run/stunnel4/stunnel-deltaquest.pid
client = yes
[DELTAQUEST_BOX_1]
accept = 10001
connect = 98:98:98:98:98:98:10001
[DELTAQUEST_BOX_2]
accept = 10002
connect = 98:98:98:98:98:98:10002
[DELTAQUEST_BOX_3]
accept = 10003
connect = 98:98:98:98:98:98:10003
[DELTAQUEST_BOX_4]
accept = 10004
connect = 98:98:98:98:98:98:10004
[DELTAQUEST_BOX_5]
accept = 10005
connect = 98:98:98:98:98:98:10005
[DELTAQUEST_BOX_6]
accept = 10006
connect = 98:98:98:98:98:98:10006
[DELTAQUEST_BOX_7]
accept = 10007
connect = 98:98:98:98:98:98:10007
[DELTAQUEST_BOX_8]
accept = 10008
connect = 98:98:98:98:98:98:10008
[DELTAQUEST_BOX_9]
accept = 10009
connect = 98:98:98:98:98:98:10009
[DELTAQUEST_BOX_10]
accept = 10010
connect = 98:98:98:98:98:98:10010
[DELTAQUEST_BOX_11]
accept = 10011
connect = 98:98:98:98:98:98:10011
[DELTAQUEST_BOX_12]
accept = 10012
connect = 98:98:98:98:98:98:10012
[DELTAQUEST_BOX_13]
accept = 10013
connect = 98:98:98:98:98:98:10013
[DELTAQUEST_BOX_14]
accept = 10014
connect = 98:98:98:98:98:98:10014
[DELTAQUEST_BOX_15]
accept = 10015
connect = 98:98:98:98:98:98:10015
[DELTAQUEST_BOX_16]
accept = 10016
connect = 98:98:98:98:98:98:10016
[DELTAQUEST_BOX_17]
accept = 10017
connect = 98:98:98:98:98:98:10017
[DELTAQUEST_BOX_18]
accept = 10018
connect = 98:98:98:98:98:98:10018
[DELTAQUEST_BOX_19]
accept = 10019
connect = 98:98:98:98:98:98:10019
[DELTAQUEST_BOX_20]
accept = 10020
connect = 98:98:98:98:98:98:10020
[DELTAQUEST_BOX_21]
accept = 10021
connect = 98:98:98:98:98:98:10021
[DELTAQUEST_BOX_22]
accept = 10022
connect = 98:98:98:98:98:98:10022
[DELTAQUEST_BOX_23]
accept = 10023
connect = 98:98:98:98:98:98:10023
[DELTAQUEST_BOX_24]
accept = 10024
connect = 98:98:98:98:98:98:10024
[DELTAQUEST_BOX_25]
accept = 10025
connect = 98:98:98:98:98:98:10025
[DELTAQUEST_BOX_26]
accept = 10026
connect = 98:98:98:98:98:98:10026
[DELTAQUEST_BOX_27]
accept = 10027
connect = 98:98:98:98:98:98:10027
[DELTAQUEST_BOX_28]
accept = 10028
connect = 98:98:98:98:98:98:10028
[DELTAQUEST_BOX_29]
accept = 10029
connect = 98:98:98:98:98:98:10029
[DELTAQUEST_BOX_30]
accept = 10030
connect = 98:98:98:98:98:98:10030
[DELTAQUEST_BOX_31]
accept = 10031
connect = 98:98:98:98:98:98:10031
[DELTAQUEST_BOX_32]
accept = 10032
connect = 98:98:98:98:98:98:10032
[DELTAQUEST_BOX_33]
accept = 10033
connect = 98:98:98:98:98:98:10033
[DELTAQUEST_BOX_34]
accept = 10034
connect = 98:98:98:98:98:98:10034
[DELTAQUEST_BOX_35]
accept = 10035
connect = 98:98:98:98:98:98:10035
[DELTAQUEST_BOX_36]
accept = 10036
connect = 98:98:98:98:98:98:10036
[DELTAQUEST_BOX_37]
accept = 10037
connect = 98:98:98:98:98:98:10037
[DELTAQUEST_BOX_38]
accept = 10038
connect = 98:98:98:98:98:98:10038
[DELTAQUEST_BOX_39]
accept = 10039
connect = 98:98:98:98:98:98:10039
[DELTAQUEST_BOX_40]
accept = 10040
connect = 98:98:98:98:98:98:10040
[DELTAQUEST_BOX_41]
accept = 10041
connect = 98:98:98:98:98:98:10041
[DELTAQUEST_BOX_42]
accept = 10042
connect = 98:98:98:98:98:98:10042
[DELTAQUEST_BOX_43]
accept = 10043
connect = 98:98:98:98:98:98:10043
[DELTAQUEST_BOX_44]
accept = 10044
connect = 98:98:98:98:98:98:10044
[DELTAQUEST_BOX_45]
accept = 10045
connect = 98:98:98:98:98:98:10045
[DELTAQUEST_BOX_46]
accept = 10046
connect = 98:98:98:98:98:98:10046
[DELTAQUEST_BOX_47]
accept = 10047
connect = 98:98:98:98:98:98:10047
[DELTAQUEST_BOX_48]
accept = 10048
connect = 98:98:98:98:98:98:10048
[DELTAQUEST_BOX_49]
accept = 10049
connect = 98:98:98:98:98:98:10040
[DELTAQUEST_BOX_50]
accept = 10050
connect = 98:98:98:98:98:98:10050

















# Add to the bottom of /etc/iptables.firewall.rules file. This permits the e-lite server to forward the connection into the e-lite server
*nat
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# Nortech DeltaQuest Ports (change the 98.98.98.98 to the applicable Nortech DeltaQuest units local IPs)
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1001 -j DNAT --to-destination 98.98.98.98:10001
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1002 -j DNAT --to-destination 98.98.98.98:10002
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1003 -j DNAT --to-destination 98.98.98.98:10003
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1004 -j DNAT --to-destination 98.98.98.98:10004
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1005 -j DNAT --to-destination 98.98.98.98:10005
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1006 -j DNAT --to-destination 98.98.98.98:10006
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1007 -j DNAT --to-destination 98.98.98.98:10007
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1008 -j DNAT --to-destination 98.98.98.98:10008
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1009 -j DNAT --to-destination 98.98.98.98:10009
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1010 -j DNAT --to-destination 98.98.98.98:10010
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1011 -j DNAT --to-destination 98.98.98.98:10011
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1012 -j DNAT --to-destination 98.98.98.98:10012
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1013 -j DNAT --to-destination 98.98.98.98:10013
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1014 -j DNAT --to-destination 98.98.98.98:10014
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1015 -j DNAT --to-destination 98.98.98.98:10015
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1016 -j DNAT --to-destination 98.98.98.98:10016
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1017 -j DNAT --to-destination 98.98.98.98:10017
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1018 -j DNAT --to-destination 98.98.98.98:10018
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1019 -j DNAT --to-destination 98.98.98.98:10019
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1020 -j DNAT --to-destination 98.98.98.98:10020
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1021 -j DNAT --to-destination 98.98.98.98:10021
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1022 -j DNAT --to-destination 98.98.98.98:10022
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1023 -j DNAT --to-destination 98.98.98.98:10023
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1024 -j DNAT --to-destination 98.98.98.98:10024
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1025 -j DNAT --to-destination 98.98.98.98:10025
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1026 -j DNAT --to-destination 98.98.98.98:10026
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1027 -j DNAT --to-destination 98.98.98.98:10027
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1028 -j DNAT --to-destination 98.98.98.98:10028
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1029 -j DNAT --to-destination 98.98.98.98:10029
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1030 -j DNAT --to-destination 98.98.98.98:10030
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1031 -j DNAT --to-destination 98.98.98.98:10031
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1032 -j DNAT --to-destination 98.98.98.98:10032
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1033 -j DNAT --to-destination 98.98.98.98:10033
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1034 -j DNAT --to-destination 98.98.98.98:10034
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1035 -j DNAT --to-destination 98.98.98.98:10035
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1036 -j DNAT --to-destination 98.98.98.98:10036
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1037 -j DNAT --to-destination 98.98.98.98:10037
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1038 -j DNAT --to-destination 98.98.98.98:10038
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1039 -j DNAT --to-destination 98.98.98.98:10039
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1040 -j DNAT --to-destination 98.98.98.98:10040
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1041 -j DNAT --to-destination 98.98.98.98:10041
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1042 -j DNAT --to-destination 98.98.98.98:10042
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1043 -j DNAT --to-destination 98.98.98.98:10043
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1044 -j DNAT --to-destination 98.98.98.98:10044
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1045 -j DNAT --to-destination 98.98.98.98:10045
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1046 -j DNAT --to-destination 98.98.98.98:10046
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1047 -j DNAT --to-destination 98.98.98.98:10047
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1048 -j DNAT --to-destination 98.98.98.98:10048
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1049 -j DNAT --to-destination 98.98.98.98:10049
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1050 -j DNAT --to-destination 98.98.98.98:10050
-A POSTROUTING -j MASQUERADE
COMMIT






THESE COMMANDS ALSO WORK OUTSIDE OF iptables FILE:
# Add rules to firewall to forward Nortech Ports to Nortech Boxes
iptables -t nat -A PREROUTING -p tcp --dport 1001 -j DNAT --to-destination [NORTECH_IP]:1001
iptables -t nat -A POSTROUTING -j MASQUERADE
