https://charlesreid1.com/wiki/RaspberryPi/SSH_Stunnel
# This script is to run on an e-lite server in order enable stunnel ssh keys passwordless login

# Enable Ipv4 forwarding at boot
sed -i '20 a echo 1 > /proc/sys/net/ipv4/ip_forward' /etc/rc.local

# Generate ssh keys
openssl genrsa -out key.pem 2048

# Generate a Self-Signed Certificate
openssl req -new -x509 -key key.pem -out cert.pem -days 14600

# Copy the keys into stunnel configuration
cat key.pem cert.pem >> /etc/stunnel/stunnel.pem
chmod 400 /etc/stunnel/stunnel.pem

# Edit Stunnel config
touch /etc/stunnel/stunnel.conf

# Populate it with the following:

output = /var/log/stunnel4/stunnel.log
cert = /etc/stunnel/stunnel.pem
key = /etc/stunnel/stunnel.pem
pid = /var/run/stunnel4/stunnel.pid
client = yes
[DELTAQUEST_BOX_1]
accept = 1001
connect = 192.168.68.201:22
[DELTAQUEST_BOX_2]
accept = 1002
connect = 192.168.68.201:22




# Add to the bottom of /etc/iptables.firewall.rules file. This permits the e-lite server to forward the connection into the e-lite server
*nat
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# Nortech DeltaQuest Ports (change the 98.98.98.98 to the applicable Nortech DeltaQuest units local IPs)
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1001 -j DNAT --to-destination 98.98.98.98:10001
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1002 -j DNAT --to-destination 98.98.98.98:10002
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1003 -j DNAT --to-destination 98.98.98.98:10003
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1004 -j DNAT --to-destination 98.98.98.98:10004
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1005 -j DNAT --to-destination 98.98.98.98:10005
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1006 -j DNAT --to-destination 98.98.98.98:10006
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1007 -j DNAT --to-destination 98.98.98.98:10007
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1008 -j DNAT --to-destination 98.98.98.98:10008
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1009 -j DNAT --to-destination 98.98.98.98:10009
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1010 -j DNAT --to-destination 98.98.98.98:10010
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1011 -j DNAT --to-destination 98.98.98.98:10011
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1012 -j DNAT --to-destination 98.98.98.98:10012
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1013 -j DNAT --to-destination 98.98.98.98:10013
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1014 -j DNAT --to-destination 98.98.98.98:10014
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1015 -j DNAT --to-destination 98.98.98.98:10015
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1016 -j DNAT --to-destination 98.98.98.98:10016
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1017 -j DNAT --to-destination 98.98.98.98:10017
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1018 -j DNAT --to-destination 98.98.98.98:10018
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1019 -j DNAT --to-destination 98.98.98.98:10019
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1020 -j DNAT --to-destination 98.98.98.98:10020
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1021 -j DNAT --to-destination 98.98.98.98:10021
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1022 -j DNAT --to-destination 98.98.98.98:10022
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1023 -j DNAT --to-destination 98.98.98.98:10023
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1024 -j DNAT --to-destination 98.98.98.98:10024
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1025 -j DNAT --to-destination 98.98.98.98:10025
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1026 -j DNAT --to-destination 98.98.98.98:10026
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1027 -j DNAT --to-destination 98.98.98.98:10027
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1028 -j DNAT --to-destination 98.98.98.98:10028
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1029 -j DNAT --to-destination 98.98.98.98:10029
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1030 -j DNAT --to-destination 98.98.98.98:10030
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1031 -j DNAT --to-destination 98.98.98.98:10031
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1032 -j DNAT --to-destination 98.98.98.98:10032
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1033 -j DNAT --to-destination 98.98.98.98:10033
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1034 -j DNAT --to-destination 98.98.98.98:10034
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1035 -j DNAT --to-destination 98.98.98.98:10035
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1036 -j DNAT --to-destination 98.98.98.98:10036
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1037 -j DNAT --to-destination 98.98.98.98:10037
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1038 -j DNAT --to-destination 98.98.98.98:10038
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1039 -j DNAT --to-destination 98.98.98.98:10039
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1040 -j DNAT --to-destination 98.98.98.98:10040
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1041 -j DNAT --to-destination 98.98.98.98:10041
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1042 -j DNAT --to-destination 98.98.98.98:10042
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1043 -j DNAT --to-destination 98.98.98.98:10043
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1044 -j DNAT --to-destination 98.98.98.98:10044
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1045 -j DNAT --to-destination 98.98.98.98:10045
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1046 -j DNAT --to-destination 98.98.98.98:10046
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1047 -j DNAT --to-destination 98.98.98.98:10047
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1048 -j DNAT --to-destination 98.98.98.98:10048
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1049 -j DNAT --to-destination 98.98.98.98:10049
-A PREROUTING -s 127.0.0.1 -p tcp --dport 1050 -j DNAT --to-destination 98.98.98.98:10050
-A POSTROUTING -j MASQUERADE
COMMIT






THESE COMMANDS ALSO WORK OUTSIDE OF iptables FILE:
# Add rules to firewall to forward Nortech Ports to Nortech Boxes
iptables -t nat -A PREROUTING -p tcp --dport 1001 -j DNAT --to-destination [NORTECH_IP]:1001
iptables -t nat -A POSTROUTING -j MASQUERADE
