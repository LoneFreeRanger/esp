###############
clear
# Gather the detail to configure stunnel with
echo ""
echo "What port numnber is the HTTP service running on the Elite application server? [i.e: 6008x])"
read httpserviceport
echo $httpserviceport > /tmp/httpserviceport
echo ""
echo "=============="
echo ""
echo "What port numnber is this e-Elite server going to listen on for HTTP interface connections? [i.e: 5008x]"
read eliteunithttpport
echo $eliteunithttpport > /tmp/eliteunithttpport
echo ""
echo "=============="
echo ""
echo "What is URL of the remote ESP application server? [i.e: [SITE_ADDRESS_CODE]-s1.esp-elite.com]"
read serverurl
echo $serverurl > /tmp/serverurl
echo ""
echo "=============="

# Get the default http stunnel config file
/usr/bin/wget --no-check-certificate https://raw.githubusercontent.com/LoneFreeRanger/esp/main/pi/scripts/http_interface_secure/e-lite_server_end/httpsecure-%5Bsiteid%5D-%5Beliteunithttpport%5D-tunnel -O /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel
chmod 777 /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel

# Configure the stunnel config file port with detail supplied
sed -i 's/eliteunithttpport/'$(cat /tmp/eliteunithttpport)'/g' /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel

# Configure the stunnel config file siteid with detail supplied
sed -i 's/siteid/'$(cat /tmp/siteid)'/g' /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel

# Configure the stunnel config file httpserviceport with detail supplied
sed -i 's/httpserviceport/'$(cat /tmp/httpserviceport)'/g' /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel

# Rename the default OS service file with detail supplied
mv /u/tunnels/httpsecure-[siteid]-[eliteunithttpport]-tunnel /u/tunnels/httpsecure-$(cat /tmp/siteid)-$(cat /tmp/eliteunithttpport)-tunnel
