# Sysinfo script for ESP Linux servers - Ray_Reilly-v22.11.23-1
# Ray Reilly 

#####################
## MAKE SETUP DIRS ##
#####################

mkdir -p /tmp/espinfo
rm -rf /tmp/espinfo/*

######################
## COLLECT THE INFO ##
######################

echo "Ray_Reilly-v22.11.23-1" > /tmp/espinfo/scriptver

# Kernel version
uname -r > /tmp/espinfo/kernelversion

rpm -q --queryformat '%{RELEASE}' rpm > /tmp/espinfo/osmajorver1
echo "$(cat /tmp/espinfo/osmajorver1 | awk '{print $1}')" > /tmp/espinfo/osmajorver1
cut -c 6 /tmp/espinfo/osmajorver1 > /tmp/espinfo/osmajorver

SPEEDTESTCHECK=$(rpm -qa | grep speedtest | wc -l)
if [ $SPEEDTESTCHECK -le 0 ]
then
curl -s https://packagecloud.io/install/repositories/ookla/speedtest-cli/script.rpm.sh | sudo bash
sudo yum -y install speedtest
else 
echo ""
fi
speedtest --accept-license --accept-gdpr > /tmp/espinfo/internetspeed
SPEEDTESTVALID=$(cat /tmp/espinfo/internetspeed | wc -l)
if [ $SPEEDTESTVALID -le 1 ]
then 
echo "Error" > /tmp/espinfo/internetupload
echo "Error" > /tmp/espinfo/internetdownload
else
cat /tmp/espinfo/internetspeed | grep "Upload:" | awk '{print $3}' > /tmp/espinfo/internetupload
cat /tmp/espinfo/internetspeed | grep "Download:" | awk '{print $3}' > /tmp/espinfo/internetdownload
cat /tmp/espinfo/internetspeed | grep "Packet Loss:" | awk '{print $3}' > /tmp/espinfo/internetpacketloss
cat /tmp/espinfo/internetspeed | grep "Idle Latency:" | awk '{print $3}' > /tmp/espinfo/internetidlelatency
fi

# Multi-site check
MULTISITECHECK=$(cat /u/gui/systems.tab | grep LICENCE_PROXY | wc -l)
if [ $MULTISITECHECK -ge 1 ]
then
echo "yes" > /tmp/espinfo/multisite
else
echo "no" > /tmp/espinfo/multisite
fi

# Get Public IP
curl -k https://icanhazip.com > /tmp/espinfo/publicipis
#echo "$(sed 's/^/public ip: /g' /tmp/espinfo/publicipis)" > /tmp/espinfo/publicip

# Get Public IP info
REDHATIPINFO=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPINFO -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publicipinfo
else
curl -k https://ipinfo.io/$(cat /tmp/espinfo/publicipis) > /tmp/espinfo/publicipinfo
fi


# Public IP region
REDHATIPREGION=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPREGION -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publicipregion
else
cat /tmp/espinfo/publicipinfo | grep region > /tmp/espinfo/publicipregion
echo "$(cat /tmp/espinfo/publicipregion|awk '{print $2}')" > c
echo "$(cat /tmp/espinfo/publicipregion)" | sed -i 's/"//g' /tmp/espinfo/publicipregion
echo "$(cat /tmp/espinfo/publicipregion)" | sed -i 's/,//g' /tmp/espinfo/publicipregion
#echo "$(sed 's/^/public ip region: /g' /tmp/espinfo/publicipregion)" > /tmp/espinfo/publicipregion
fi

# Public IP city
REDHATIPCITY=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPCITY -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publicipcity
else
cat /tmp/espinfo/publicipinfo | grep city > /tmp/espinfo/publicipcity
echo "$(cat /tmp/espinfo/publicipcity|awk '{print $2}')" > /tmp/espinfo/publicipcity
echo "$(cat /tmp/espinfo/publicipcity)" | sed -i 's/"//g' /tmp/espinfo/publicipcity
echo "$(cat /tmp/espinfo/publicipcity)" | sed -i 's/,//g' /tmp/espinfo/publicipcity
#echo "$(sed 's/^/public ip city: /g' /tmp/espinfo/publicipcity)" > /tmp/espinfo/publicipcity
fi

# Public IP country
REDHATIPCOUNTRY=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPCOUNTRY -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publicipcountry
else
cat /tmp/espinfo/publicipinfo | grep country > /tmp/espinfo/publicipcountry
echo "$(cat /tmp/espinfo/publicipcountry|awk '{print $2}')" > /tmp/espinfo/publicipcountry
echo "$(cat /tmp/espinfo/publicipcountry)" | sed -i 's/"//g' /tmp/espinfo/publicipcountry
echo "$(cat /tmp/espinfo/publicipcountry)" | sed -i 's/,//g' /tmp/espinfo/publicipcountry
#echo "$(sed 's/^/public ip country: /g' /tmp/espinfo/publicipcountry)" > /tmp/espinfo/publicipcountry
fi

# Public IP organisation
REDHATIPORG=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPORG -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publiciporganisation
else
cat /tmp/espinfo/publicipinfo | grep org > /tmp/espinfo/publiciporganisation
echo "$(cat /tmp/espinfo/publiciporganisation|awk '{print $2" "$3" "$4" "$5}')" > /tmp/espinfo/publiciporganisation
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/"//g' /tmp/espinfo/publiciporganisation
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/,//g' /tmp/espinfo/publiciporganisation
#echo "$(sed 's/^/public ip org: /g' /tmp/espinfo/publiciporganisation)" > /tmp/espinfo/publiciporganisation
fi

# Public IP longitude and latitude
REDHATIPGEO=$(cat /etc/redhat-release | grep "Red Hat Enterprise Linux Server release 6.*" | wc -l)
if [ $REDHATIPGEO -ge 1 ]
then
echo "Curl Error - Redhat 6" > /tmp/espinfo/publicipgeoloc
else
cat /tmp/espinfo/publicipinfo | grep loc > /tmp/espinfo/publicipgeoloc
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/loc//g' /tmp/espinfo/publicipgeoloc
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/"//g' /tmp/espinfo/publicipgeoloc
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/://g' /tmp/espinfo/publicipgeoloc
echo "$(cat /tmp/espinfo/publiciporganisation)" | sed -i 's/ //g' /tmp/espinfo/publicipgeoloc
#echo "$(sed 's/^/public ip geolocation: /g' /tmp/espinfo/publicipgeoloc)" > /tmp/espinfo/publicipgeoloc
fi

rm -rf /tmp/espinfo/publicipinfo

hostname > /tmp/espinfo/hostname
#echo "$(sed 's/^/hostname: /g' /tmp/espinfo/hostname)" > /tmp/espinfo/hostname

/usr/sbin/ip route > /tmp/espinfo/hostgateway
sed -i -n '2p' /tmp/espinfo/hostgateway

/usr/sbin/ip route > /tmp/espinfo/hostip
sed -i -n '1p' /tmp/espinfo/hostip

COMMS=$(find /u/esp -name systems.tab -exec grep "COMMS_SERVER" '{}' \; -print | wc -l)
if [ $COMMS -ge 1 ]
then
echo "yes" > /tmp/espinfo/comms
else
echo "no" > /tmp/espinfo/comms
fi



ESPCLIENT_PRESENT=$(ls -l /u/ups/espclient.upg | wc -l)
ESPCLIENT=(/u/ups/espclient.upg)
ESPCLIENTMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
rm -rf /tmp/espinfo/espclientver
if [ $ESPCLIENTMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/espclientver
elif [ $ESPCLIENT_PRESENT -ge 1 ]
then
what -s $ESPCLIENT >> /tmp/espinfo/espclientver
echo "$(tail -n 1 /tmp/espinfo/espclientver)" > /tmp/espinfo/espclientver
echo "$(cat /tmp/espinfo/espclientver|awk '{print $2}')" > /tmp/espinfo/espclientver
#echo "$(sed 's/^/espclient.upg version: /g' /tmp/espinfo/espclientver)" > /tmp/espinfo/espclientver
else
echo "n/a" > /tmp/espinfo/espclientver
fi

ESPCLIENTDATE=$(ls -l /u/ups/espclient.upg | wc -l)
ESPCLIENTMULTI2=$(cat /u/gui/systems.tab | grep LICENCE_PROXY | wc -l)
if [ $ESPCLIENTMULTI2 -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/espclientdate
elif [ $ESPCLIENTDATE -le 0 ] 
then
echo "n/a" > /tmp/espinfo/espclientdate
else
date -r /u/ups/espclient.upg -R > /tmp/espinfo/espclientdate
echo "$(cat /tmp/espinfo/espclientdate|awk '{print $2" "$3" "$4}')" > /tmp/espinfo/espclientdate
#echo "$(sed 's/^/espclient.upg date: /g' /tmp/espinfo/espclientdate)" > /tmp/espinfo/espclientdate
fi



what -s /u/gui/espsite > /tmp/espinfo/espsite
echo "$(tail -n 1 /tmp/espinfo/espsite)" > /tmp/espinfo/espsite
echo "$(cat /tmp/espinfo/espsite|awk '{print $3}')" > /tmp/espinfo/espsite
#echo "$(sed 's/^/espsite ver: /g' /tmp/espinfo/espsite)" > /tmp/espinfo/espsite

ls -l /u/gui/espsite > /tmp/espinfo/espsitesize
echo "$(cat /tmp/espinfo/espsitesize|awk '{print $5}')" > /tmp/espinfo/espsitesize
#echo "$(sed 's/^/espsite size: /g' /tmp/espinfo/espsitesize)" > /tmp/espinfo/espsitesize

cat /etc/redhat-release > /tmp/espinfo/osversion
#echo "$(sed 's/^/os version: /g' /tmp/espinfo/osversion)" > /tmp/espinfo/osversion

/usr/sbin/dmidecode | grep -A3 '^System Information' | grep 'Product' > /tmp/espinfo/serverpro
echo "$(sed 's/^...............//' /tmp/espinfo/serverpro)" > /tmp/espinfo/serverpro
#echo "$(sed 's/^/server model: /g' /tmp/espinfo/serverpro)" > /tmp/espinfo/serverpro

/usr/sbin/dmidecode | grep -A3 '^System Information' | grep 'Manufacturer' > /tmp/espinfo/serverman
echo "$(sed 's/^...............//' /tmp/espinfo/serverman)" > /tmp/espinfo/serverman
#echo "$(sed 's/^/server manufacturer: /g' /tmp/espinfo/serverman)" > /tmp/espinfo/serverman

getconf LONG_BIT > /tmp/espinfo/osarch
#echo "$(sed 's/^/os bit-rate: /g' /tmp/espinfo/osarch)" > /tmp/espinfo/osarch

ESPPROCS_USB=$(cat /u/espbin/espprocs | grep backupU2usb | wc -l)
USB_LOG=$(head -n7 /u/logs/backup/ESPBackUpRpt.log | grep 'Backup Success. Please ensure next USB Stick is in Server' | wc -l) 
BACKUP_LOG=$(find /u/logs/backup -type f -mtime -7 -exec ls -l {} \; | wc -l) 
UVAULT=$(ps -ef | grep cbb | wc -l)
UVAULT_CBB=$(ps -ef | grep cbb | wc -l)
if [ $ESPPROCS_USB -ge "1" ] && [ $USB_LOG -ge "1" ]
then
echo "USB"  > /tmp/espinfo/backuptype
elif [ $UVAULT -ge "1" ] && [ $UVAULT_CBB -ge "1" ]
then 
echo "uVault"  > /tmp/espinfo/backuptype
else 
echo "Unknown"  > /tmp/espinfo/backuptype
fi

POS5FILE=$(ls -l /u/ups/pos5file | wc -l)
POS5FILEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS5FILEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/pos5date
elif [ $POS5FILE -ge 1 ]
then
date -r /u/ups/pos5file -R > /tmp/espinfo/pos5date
echo "$(cat /tmp/espinfo/pos5date|awk '{print $2" "$3" "$4}')" > /tmp/espinfo/pos5date
#echo "$(sed 's/^/pos5 date: /g' /tmp/espinfo/pos5date)" > /tmp/espinfo/pos5date
else
echo "n/a" > /tmp/espinfo/pos5date
fi

POS6FILE=$(ls -l /u/ups/pos6file | wc -l)
POS6FILEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS6FILEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/pos6date
elif [ $POS6FILE -ge 1 ]
then
date -r /u/ups/pos6file -R > /tmp/espinfo/pos6date
echo "$(cat /tmp/espinfo/pos6date|awk '{print $2" "$3" "$4}')" > /tmp/espinfo/pos6date
#echo "$(sed 's/^/pos6 date: /g' /tmp/espinfo/pos6date)" > /tmp/espinfo/pos6date
else
echo "n/a" > /tmp/espinfo/pos6date
fi


POS7FILE=$(ls -l /u/ups/pos7file | wc -l)
POS7FILEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS7FILEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/pos7date
elif [ $POS7FILE -ge 1 ]
then
date -r /u/ups/pos7file -R > /tmp/espinfo/pos7date
echo "$(cat /tmp/espinfo/pos7date|awk '{print $2" "$3" "$4}')" > /tmp/espinfo/pos7date
#echo "$(sed 's/^/pos7 date: /g' /tmp/espinfo/pos7date)" > /tmp/espinfo/pos7date
else
echo "n/a" > /tmp/espinfo/pos7date
fi


VNCPROCESSES=$(ps -ef | grep vnc | wc -l)
CLIENTDIRS=$(find /home -name client* | wc -l)
if [ $VNCPROCESSES -ge 1 ] && [ $CLIENTDIRS -ge 1 ]
then
echo "yes" > /tmp/espinfo/elitego
else
echo "no" > /tmp/espinfo/elitego
fi

cat /proc/cpuinfo | grep "processor" | wc -l > /tmp/espinfo/cpucores
#echo "$(sed 's/^/server cpu cores: /g' /tmp/espinfo/cpucores)" > /tmp/espinfo/cpucores

cat /proc/cpuinfo | grep "model name" > /tmp/espinfo/cpumodel
echo "$(sed 's/^.............//' /tmp/espinfo/cpumodel)" > /tmp/espinfo/cpumodel
echo "$(tail -n 1 /tmp/espinfo/cpumodel)" > /tmp/espinfo/cpumodel
#echo "$(sed 's/^/server cpu model: /g' /tmp/espinfo/cpumodel)" > /tmp/espinfo/cpumodel

MONITPID=$(pidof monit | wc -l)
MONITRC=$(find /etc/monitrc | wc -l)
if [ $MONITPID -ge 1 ]
then
echo "yes" > /tmp/espinfo/monit
else
echo "no" > /tmp/espinfo/monit
fi

USESEFT=$(find /u -name "efttrans.dat" -mtime -7 | wc -l)
if [ $USESEFT -ge 1 ]
then
echo "yes" > /tmp/espinfo/useseft
else
echo "no" > /tmp/espinfo/useseft
fi

uptime > /tmp/espinfo/srvuptime
echo "$(cat /tmp/espinfo/srvuptime|awk '{print $3" "$4}')" > /tmp/espinfo/srvuptime
#echo "$(sed 's/^/server uptime: /g' /tmp/espinfo/srvuptime)" > /tmp/espinfo/srvuptime
sed -i 's/\,//g' /tmp/espinfo/srvuptime

ACCESSCTL1=$(find /u -name systems.tab -exec grep "AACCESS_CONTROL" '{}' \; -print | wc -l)
ACCESSCTL2=$(find /u -iname "aserverr.log" -atime -1 -type f | wc -l)
if [ $ACCESSCTL1 -ge 1 ] && [ $ACCESSCTL2 -ge 1 ]
then
echo "yes" > /tmp/espinfo/accessctl
else
echo "no" > /tmp/espinfo/accessctl
fi

RANGE1=$(find /u -name systems.tab -exec grep "RANGE_SERVANT" '{}' \; -print | wc -l)
RANGE2=$(find /u -iname "wserverr.log" -atime -1 -type f | wc -l)
if [ $RANGE1 -ge 1 ] && [ $RANGE2 -ge 1 ]
then
echo "yes" > /tmp/espinfo/range
else
echo "no" > /tmp/espinfo/range
fi

EXPORT=$(netstat -a | grep 50001 | wc -l)
if [ $EXPORT -ge 1 ]
then
echo "yes" > /tmp/espinfo/export
else
echo "no" > /tmp/espinfo/export
fi

PHONES1=$(find /u -name systems.tab -exec grep "PPHONES" '{}' \; -print | wc -l)
if [ $PHONES1 -ge 1 ]
then
echo "yes" > /tmp/espinfo/phones
else
echo "no" > /tmp/espinfo/phones
fi

LISTERMSMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $LISTERMSMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/licencelist
else
/u/gui/whoui listterms > /tmp/espinfo/licencelist
echo "$(sed '/*/d' /tmp/espinfo/licencelist)"  > /tmp/espinfo/licencelist
echo "$(sed '/10.0.0.3/d' /tmp/espinfo/licencelist)" > /tmp/espinfo/licencelist
echo "$(sed '/127.0.0.1/d' /tmp/espinfo/licencelist)" > /tmp/espinfo/licencelist
echo "$(sed '/Dummy/d' /tmp/espinfo/licencelist)" > /tmp/espinfo/licencelist
echo "$(sed '/Remote Support/d' /tmp/espinfo/licencelist)" > /tmp/espinfo/licencelist
echo "$(sed '/Server/d' /tmp/espinfo/licencelist)" > /tmp/espinfo/licencelist
cat /tmp/espinfo/licencelist | wc -l > /tmp/espinfo/nooflicences
#echo "$(sed 's/^/number of esp licenses: /g' /tmp/espinfo/nooflicences)" > /tmp/espinfo/nooflicences
rm -rf /tmp/espinfo/licencelist
fi

SOFTWARERAIDED=$(df -h | grep md0 | wc -l)
if [ $SOFTWARERAIDED -ge 1 ]
then
echo "yes" > /tmp/espinfo/softwareraid
else
echo "no" > /tmp/espinfo/softwareraid
fi

df -h --total|grep ^total | awk '{print $2}' > /tmp/espinfo/hddsize

free -g > /tmp/espinfo/ramsize
echo "$(head -2 /tmp/espinfo/ramsize)" > /tmp/espinfo/ramsize
echo "$(tail -n 1 /tmp/espinfo/ramsize)" > /tmp/espinfo/ramsize
echo "$(cat /tmp/espinfo/ramsize|awk '{print $2}')" > /tmp/espinfo/ramsize
#echo "$(sed 's/^/server ram (GB): /g' /tmp/espinfo/ramsize)" > /tmp/espinfo/ramsize

rpm -qi basesystem | grep "Install Date" > /tmp/espinfo/sysage
echo "$(cat /tmp/espinfo/sysage|awk '{print $4" "$5" "$6}')" > /tmp/espinfo/sysage
#echo "$(sed 's/^/server age: /g' /tmp/espinfo/sysage)" > /tmp/espinfo/sysage

ODBC999=$(/u/gui/whoui listterms | grep "999.999.999.1" | wc -l)
if [ $ODBC999 -ge 1 ]
then 
echo "yes" > /tmp/espinfo/odbc
else
echo "no" > /tmp/espinfo/odbc
fi

rpm -qa | wc -l > /tmp/espinfo/serverpackages
#echo "$(sed 's/^/os packages no: /g' /tmp/espinfo/serverpackages)" > /tmp/espinfo/serverpackages

df -Th /u/gui/espip.dat > /tmp/espinfo/serverfilesystem
echo "$(cat /tmp/espinfo/serverfilesystem|awk '{print $2}')" > /tmp/espinfo/serverfilesystem
echo "$(tail -n 1 /tmp/espinfo/serverfilesystem)" > /tmp/espinfo/serverfilesystem
#echo "$(sed 's/^/os filesystem: /g' /tmp/espinfo/serverfilesystem)" > /tmp/espinfo/serverfilesystem

AFDPRESENT=$(find /u/gui -name afdlookup | wc -l)
if [ $AFDPRESENT -ge 1 ]
then
what -s /u/gui/afdlookup > /tmp/espinfo/afdlookup
echo "$(tail -n 1 /tmp/espinfo/afdlookup)" > /tmp/espinfo/afdlookup
echo "$(cat /tmp/espinfo/afdlookup|awk '{print $3}')" > /tmp/espinfo/afdlookup
#echo "$(sed 's/^/afdlookup version: /g' /tmp/espinfo/afdlookup)" > /tmp/espinfo/afdlookup
else
echo "n/a" > /tmp/espinfo/afdlookup
fi
#=====
BLANKAFDVER=$(find /tmp/espinfo -name afdlookup -size -5c -exec ls -lh {} \; | wc -l)
if [ $BLANKAFDVER -ge 1 ]
then
echo "blank version" > /tmp/espinfo/afdlookup
else 
echo "n/a" > /tmp/espinfo/afdlookup
fi

CUSTMINDFILE=$(find /u -iname "custmind.csv*" -atime -7 -type f | wc -l)
if [ $CUSTMINDFILE -ge 1 ]
then 
echo "yes" > /tmp/espinfo/custmind
else
echo "no" > /tmp/espinfo/custmind
fi

HTTPSERVICE1=$(netstat -a | grep 50080 | wc -l)
HTTPSERVICE2=$(netstat -a | grep 50081 | wc -l)
if [ $HTTPSERVICE1 -ge 1 ] || [ $HTTPSERVICE2 -ge 1 ]
then
echo "yes" > /tmp/espinfo/httpservice
else
echo "no" > /tmp/espinfo/httpservice
fi


########################################

find /u/esp -type f -name bsms.rh5 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh5date
BSMS5DATEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMS5DATEPRESENT=$(cat /tmp/espinfo/bsmsrh5date | wc -l)
if [ $BSMS5DATEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh5date
elif [ $BSMS5DATEPRESENT -le 0 ]
then
echo "n/a" > /tmp/espinfo/bsmsrh5date
else
echo "$(tail -n 1 /tmp/espinfo/bsmsrh5date)" > /tmp/espinfo/bsmsrh5date
echo "$(cat /tmp/espinfo/bsmsrh5date|awk '{print $6" "$7" "$8}')" > /tmp/espinfo/bsmsrh5date
#echo "$(sed 's/^/bsms.rh5 date: /g' /tmp/espinfo/bsmsrh5date)" > /tmp/espinfo/bsmsrh5date
fi

find /u/esp -type f -name bsms.rh8 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh8date
BSMS8DATEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMS8DATEPRESENT=$(cat /tmp/espinfo/bsmsrh8date | wc -l)
if [ $BSMS8DATEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh8date
elif [ $BSMS8DATEPRESENT -le 0 ]
then
echo "n/a" > /tmp/espinfo/bsmsrh8date
else
echo "$(tail -n 1 /tmp/espinfo/bsmsrh8date)" > /tmp/espinfo/bsmsrh8date
echo "$(cat /tmp/espinfo/bsmsrh8date|awk '{print $6" "$7" "$8}')" > /tmp/espinfo/bsmsrh8date
#echo "$(sed 's/^/bsms.rh8 date: /g' /tmp/espinfo/bsmsrh8date)" > /tmp/espinfo/bsmsrh8date
fi

find /u/esp -type f -name bsms.l64 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsl64date
BSMSL64DATEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMSL64DATEPRESENT=$(cat /tmp/espinfo/bsmsl64date | wc -l)
if [ $BSMSL64DATEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsl64date
elif [ $BSMSL64DATEPRESENT -le 0 ]
then
echo "n/a" > /tmp/espinfo/bsmsl64date
else
echo "$(tail -n 1 /tmp/espinfo/bsmsl64date)" > /tmp/espinfo/bsmsl64date
echo "$(cat /tmp/espinfo/bsmsl64date|awk '{print $6" "$7" "$8}')" > /tmp/espinfo/bsmsl64date
#echo "$(sed 's/^/bsms.l64 date: /g' /tmp/espinfo/bsmsl64date)" > /tmp/espinfo/bsmsl64date
fi

BSMSRH5=$(ls -l /u/ups/pos5file | wc -l)
POS5FILEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS5FILEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh5
elif [ $BSMSRH5 -ge 1 ]
then
find /u/esp -type f -name bsms.rh5 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh5
echo "$(tail -n 1 /tmp/espinfo/bsmsrh5)" > /tmp/espinfo/bsmsrh5
echo "$(cat /tmp/espinfo/bsmsrh5|awk '{print $9}')" > /tmp/espinfo/bsmsrh5
BSMSRH5=$(cat /tmp/espinfo/bsmsrh5)
echo "$(what -s $BSMSRH5)"  > /tmp/espinfo/bsmsrh5
echo "$(tail -n 1 /tmp/espinfo/bsmsrh5)" > /tmp/espinfo/bsmsrh5
echo "$(cat /tmp/espinfo/bsmsrh5|awk '{print $3}')" > /tmp/espinfo/bsmsrh5
#echo "$(sed 's/^/bsms.rh5 version: /g' /tmp/espinfo/bsmsrh5)" > /tmp/espinfo/bsmsrh5
elif [ $BSMSRH5 -le 0 ]
then
echo "n/a"  > /tmp/espinfo/bsmsrh5
#echo "$(sed 's/^/bsms.rh5 version: /g' /tmp/espinfo/bsmsrh5)" > /tmp/espinfo/bsmsrh5
fi

BSMSRH8_2=$(ls -l /u/ups/pos6file | wc -l)
POS6FILEMULTI_2=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS6FILEMULTI_2 -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh8
#elif [ $BSMSRH8_2 -le 0 ]
#then
#echo "n/a" > /tmp/espinfo/bsmsrh8
elif [ $POS6FILEMULTI_2 -le 0 ]
then
find /u/esp -type f -name bsms.rh8 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh8
echo "$(tail -n 1 /tmp/espinfo/bsmsrh8)" > /tmp/espinfo/bsmsrh8
echo "$(cat /tmp/espinfo/bsmsrh8|awk '{print $9}')" > /tmp/espinfo/bsmsrh8
BSMSRH8_3=$(cat /tmp/espinfo/bsmsrh8)
echo "$(what -s $BSMSRH8_3)"  > /tmp/espinfo/bsmsrh8
echo "$(tail -n 1 /tmp/espinfo/bsmsrh8)" > /tmp/espinfo/bsmsrh8
echo "$(cat /tmp/espinfo/bsmsrh8|awk '{print $3}')" > /tmp/espinfo/bsmsrh8
elif [ $BSMSRH8_3 -le 0 ]
then
echo "n/a"  > /tmp/espinfo/bsmsrh8
fi

BSMSL64=$(ls -l /u/ups/pos7file | wc -l)
POS7FILEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $POS7FILEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsl64
elif [ $BSMSL64 -le 0 ]
then
echo "n/a" > /tmp/espinfo/bsmsl64
elif [ $BSMSL64 -ge 1 ]
then
find /u/esp -type f -name bsms.l64 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsl64
echo "$(tail -n 1 /tmp/espinfo/bsmsl64)" > /tmp/espinfo/bsmsl64
echo "$(cat /tmp/espinfo/bsmsl64|awk '{print $9}')" > /tmp/espinfo/bsmsl64
BSMSL64=$(cat /tmp/espinfo/bsmsl64)
echo "$(what -s $BSMSL64)"  > /tmp/espinfo/bsmsl64
echo "$(tail -n 1 /tmp/espinfo/bsmsl64)" > /tmp/espinfo/bsmsl64
echo "$(cat /tmp/espinfo/bsmsl64|awk '{print $3}')" > /tmp/espinfo/bsmsl64
elif [ $BSMSL64 -le 0 ]
then
echo "n/a"  > /tmp/espinfo/bsmsl64
fi

find /u/esp -type f -name bsms.rh5 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh5size
BSMS5SIZEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMS5SIZEPRESENT=$(cat /tmp/espinfo/bsmsrh5size | wc -l)
if [ $BSMS5SIZEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh5size
elif [ $BSMS5SIZEPRESENT -le 0 ]
then 
echo "n/a" > /tmp/espinfo/bsmsrh5size
else
echo "$(tail -n 1 /tmp/espinfo/bsmsrh5size)" > /tmp/espinfo/bsmsrh5size
echo "$(cat /tmp/espinfo/bsmsrh5size|awk '{print $5}')" > /tmp/espinfo/bsmsrh5size
#echo "$(sed 's/^/bsms.rh5 size (bytes): /g' /tmp/espinfo/bsmsrh5size)" > /tmp/espinfo/bsmsrh5size
fi

find /u/esp -type f -name bsms.rh8 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsrh8size
BSMS8SIZEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMS8SIZEPRESENT=$(cat /tmp/espinfo/bsmsrh8size | wc -l)
if [ $BSMS8SIZEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh8size
elif [ $BSMS8SIZEPRESENT -le 0 ]
then 
echo "n/a" > /tmp/espinfo/bsmsrh8size
else
echo "$(tail -n 1 /tmp/espinfo/bsmsrh8size)" > /tmp/espinfo/bsmsrh8size
echo "$(cat /tmp/espinfo/bsmsrh8size|awk '{print $5}')" > /tmp/espinfo/bsmsrh8size
#echo "$(sed 's/^/bsms.rh8 size (bytes): /g' /tmp/espinfo/bsmsrh8size)" > /tmp/espinfo/bsmsrh8size
fi


find /u/esp -type f -name bsms.l64 -exec ls -ltu {} \; | sort -k 5 - > /tmp/espinfo/bsmsl64size
BSMSL64SIZEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
BSMSL64SIZEPRESENT=$(cat /tmp/espinfo/bsmsl64size | wc -l)
if [ $BSMSL64SIZEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsl64size
elif [ $BSMSL64SIZEPRESENT -le 0 ]
then 
echo "n/a" > /tmp/espinfo/bsmsl64size
else
echo "$(tail -n 1 /tmp/espinfo/bsmsl64size)" > /tmp/espinfo/bsmsl64size
echo "$(cat /tmp/espinfo/bsmsl64size|awk '{print $5}')" > /tmp/espinfo/bsmsl64size
#echo "$(sed 's/^/bsms.l64 size (bytes): /g' /tmp/espinfo/bsmsl64size)" > /tmp/espinfo/bsmsl64size
fi




########################################

ARERUNNINGRH5=$(ps -ef | grep bsms.rh5 | wc -l)
ARERUNNINGRH8=$(ps -ef | grep bsms.rh8 | wc -l)
ARERUNNINGL64=$(ps -ef | grep bsms.l64 | wc -l)
RUNTIMEMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $RUNTIMEMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/runtime
elif [ $ARERUNNINGRH5 -ge 5 ]
then
echo "bsms.rh5" > /tmp/espinfo/runtime
elif [ $ARERUNNINGRH8 -ge 5 ]
then
echo "bsms.rh8" > /tmp/espinfo/runtime
elif [ $ARERUNNINGL64 -ge 5 ]
then
echo "bsms.l64" > /tmp/espinfo/runtime
else
echo "No_Running_bsms_processes" > /tmp/espinfo/runtime
fi

ESPCLIENTSIZ_PRESENT=$(ls -l /u/ups/espclient.upg | wc -l)
ESPCLIENTSIZ=(/u/ups/espclient.upg)
ESPCLIENTMULTI=$(cat /tmp/espinfo/multisite | grep yes | wc -l)
if [ $ESPCLIENTMULTI -ge 1 ]
then
echo "[MULTISITE GUI]" > /tmp/espinfo/bsmsrh5size
elif [ $ESPCLIENTSIZ_PRESENT -ge 1 ]
then
ls -l  $ESPCLIENTSIZ >> /tmp/espinfo/espclientsize
echo "$(cat /tmp/espinfo/espclientsize|awk '{print $5}')" > /tmp/espinfo/espclientsize
#echo "$(sed 's/^/espclient.upg size (bytes): /g' /tmp/espinfo/espclientsize)" > /tmp/espinfo/espclientsize
else
echo "n/a" > /tmp/espinfo/espclientsize
fi

/usr/sbin/dmidecode | grep -A4 '^System Information' | grep 'Serial' > /tmp/espinfo/serverserial
echo "$(cat /tmp/espinfo/serverserial|awk '{print $3}')" > /tmp/espinfo/serverserial
#echo "$(sed 's/^/server serial id: /g' /tmp/espinfo/serverserial)" > /tmp/espinfo/serverserial

/usr/sbin/dmidecode | grep -A7 '^System Information' | grep 'SKU Number' > /tmp/espinfo/serversku
echo "$(cat /tmp/espinfo/serversku|awk '{print $3}')" > /tmp/espinfo/serversku
#echo "$(sed 's/^/server sku id: /g' /tmp/espinfo/serversku)" > /tmp/espinfo/serversku

date > /tmp/espinfo/dateofinfo
#echo "$(sed 's/^/date of this info: /g' /tmp/espinfo/dateofinfo)" > /tmp/espinfo/dateofinfo

FINDESPCLIENT32=$(find /home/linuxclient/client -name espclient32  | wc -l)
if [ $FINDESPCLIENT32 == 1 ]
then
what -s /home/linuxclient/client/espclient32 > /tmp/espinfo/linux32ver
echo "$(tail -n 1 /tmp/espinfo/linux32ver)" > /tmp/espinfo/linux32ver
echo "$(cat /tmp/espinfo/linux32ver|awk '{print $2}')" > /tmp/espinfo/linux32ver
#echo "$(sed 's/^/linux espclient32 version: /g' /tmp/espinfo/linux32ver)" > /tmp/espinfo/linux32ver
else
echo "n/a"  > /tmp/espinfo/linux32ver
fi

FINDESPCLIENT64=$(find /home/linuxclient/client -name espclient64  | wc -l)
if [ $FINDESPCLIENT64 == 1 ]
then
what -s /home/linuxclient/client/espclient64 > /tmp/espinfo/linux64ver
echo "$(tail -n 1 /tmp/espinfo/linux64ver)" > /tmp/espinfo/linux64ver
echo "$(cat /tmp/espinfo/linux64ver|awk '{print $2}')" > /tmp/espinfo/linux64ver
#echo "$(sed 's/^/linux espclient64 version: /g' /tmp/espinfo/linux64ver)" > /tmp/espinfo/linux64ver
else
echo "n/a"  > /tmp/espinfo/linux64ver
fi

touch /tmp/espinfo/syslastused
cat /u/gui/esp.log | grep "Connection from" > /tmp/lastused.txt
sed -i '/195.171.180.242/d' /tmp/lastused.txt
echo "$(tail -n1 /tmp/lastused.txt | awk '{print $6" "$7" "$8" "$9}')" > /tmp/espinfo/syslastused
#echo "$(sed 's/^/system last used: /g' /tmp/espinfo/syslastused)" > /tmp/espinfo/syslastused

find /u -type f -name eft -exec ls -lart {} \; > /tmp/espinfo/eftverfind
echo "$(tail -n 1 /tmp/espinfo/eftverfind)" > /tmp/espinfo/eftverfind
cat /tmp/espinfo/eftverfind | awk '{print $9}' > /tmp/espinfo/eftverfind1 && mv -f /tmp/espinfo/eftverfind1 /tmp/espinfo/eftverfind
what -s $(cat /tmp/espinfo/eftverfind) > /tmp/espinfo/eftver
tail -n1 /tmp/espinfo/eftver | awk '{print $3}' > /tmp/espinfo/eftver1 && mv -f /tmp/espinfo/eftver1 /tmp/espinfo/eftver
rm -rf /tmp/espinfo/eftverfind



################################
# New November 2023
################################



find /u -name systems.tab -exec grep -H 'EVENT_FLAG' {} \; > /tmp/espinfo/eventflagfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/eventflagfind
EVENTFLAGCOUNT=$(cat /tmp/espinfo/eventflagfind | wc -l)
if [ $EVENTFLAGCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasevents
else
echo "no" > /tmp/espinfo/hasevents
fi
rm -rf /tmp/espinfo/eventflagfind

find /u -name systems.tab -exec grep -H 'CUSTOMER_ASSETS' {} \; > /tmp/espinfo/cutomerassetsfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/cutomerassetsfind
CUSTOMERASSETSFLAGCOUNT=$(cat /tmp/espinfo/cutomerassetsfind | wc -l)
if [ $CUSTOMERASSETSFLAGCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hascustomerassets
else
echo "no" > /tmp/espinfo/hascustomerassets
fi
rm -rf /tmp/espinfo/cutomerassetsfind

find /u -name systems.tab -exec grep -H 'POS_TABLES' {} \; > /tmp/espinfo/postablesfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/postablesfind
POSTABLESFLAGCOUNT=$(cat /tmp/espinfo/postablesfind | wc -l)
if [ $POSTABLESFLAGCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/haspostables
else
echo "no" > /tmp/espinfo/haspostables
fi
rm -rf /tmp/espinfo/postablesfind

find /u -name espapps.tab -exec grep -H 'IDSCOREINPUT' {} \; > /tmp/espinfo/kioskfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/kioskfind
KIOSKFINDCOUNT=$(cat /tmp/espinfo/kioskfind | wc -l)
if [ $KIOSKFINDCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/haskiosk
else
echo "no" > /tmp/espinfo/haskiosk
fi
rm -rf /tmp/espinfo/kioskfind

find /u -name systems.tab -exec grep -H 'BOOK_PRODUCTS Enabled=1&ActivityType=FB Online' {} \; > /tmp/espinfo/fbonlinefind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/fbonlinefind
FBONLINECOUNT=$(cat /tmp/espinfo/fbonlinefind | wc -l)
if [ $FBONLINECOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasfbonline
else
echo "no" > /tmp/espinfo/hasfbonline
fi
rm -rf /tmp/espinfo/fbonlinefind

find /u -name systems.tab -exec grep -H 'REMOTE_PRICE_CHECK ReportName=' {} \; > /tmp/espinfo/remotepricecheckfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/remotepricecheckfind
REMOTEPRICECHECKCOUNT=$(cat /tmp/espinfo/remotepricecheckfind | wc -l)
if [ $REMOTEPRICECHECKCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasremotepricecheck
else
echo "no" > /tmp/espinfo/hasremotepricecheck
fi
rm -rf /tmp/espinfo/remotepricecheckfind

# Does not work for lightsail virtuals ?
#dmidecode | grep Product > /tmp/espinfo/isavirtualserverfind
#VIRTUALSERVERFIND=$(cat /tmp/espinfo/isavirtualserverfind | grep Virtual | wc -l)
#if [ $VIRTUALSERVERFIND -ge 1 ]
#then
#echo "yes" > /tmp/espinfo/isavirtualserver
#else
#echo "no" > /tmp/espinfo/isavirtualserver
#fi
#rm -rf /tmp/espinfo/isavirtualserverfind

LOCATTRBFIND=$(find /u -name locattrb.tab | wc -l)
LOCTYPEFIND=$(find /u -name loctype.tab | wc -l)
if [ $LOCATTRBFIND -ge 1 ] && [ $LOCATTRBFIND -ge 1 ]
then
echo "yes" > /tmp/espinfo/haslocationbookings
else
echo "no" > /tmp/espinfo/haslocationbookings
fi

TOBACSFIND=$(find /u -type f -name "tobacs.txt" -mtime -60 | wc -l)
AUDDISFIND=$(find /u -type f -name "auddis.txt" -mtime -60 | wc -l)
if [ $TOBACSFIND -ge 1 ] || [ $AUDDISFIND -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasdirectdebit
else
echo "no" > /tmp/espinfo/hasdirectdebit
fi

find /u -name aserverr.log -exec grep -H "Trying ./monitors/" {} \; > /tmp/espinfo/recentaserverr
ACCMONITORSUSEAGE=$(cat /tmp/espinfo/recentaserverr | grep "Trying ./monitors/" | wc -l)
if [ $ACCMONITORSUSEAGE -ge 1 ]
then
echo "yes" > /tmp/espinfo/accesscontrolmonitors
else
echo "no" > /tmp/espinfo/accesscontrolmonitors
fi
rm -rf /tmp/espinfo/recentaserverr

find /u -name wserverr.log -exec grep -H 'Arrived' {} \; > /tmp/espinfo/recentwserverrarrived
ACCARRIVEDUSEAGE=$(cat /tmp/espinfo/recentwserverrarrived | grep "Arrived" | wc -l)
if [ $ACCARRIVEDUSEAGE -ge 1 ]
then
echo "yes" > /tmp/espinfo/accesscontrolactivity
else
echo "no" > /tmp/espinfo/accesscontrolactivity
fi
rm -rf /tmp/espinfo/recentwserverrarrived

cat /u/esp/*/espapps.tab | grep pms > /tmp/espinfo/pmsfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/pmsfind
PMSSYTEMCOUNT=$(cat /tmp/espinfo/pmsfind | wc -l)
if [ $PMSSYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/haspmssystem
else
echo "no" > /tmp/espinfo/haspmssystem
fi
rm -rf /tmp/espinfo/pmsfind

cat /u/esp/*/espapps.tab | grep retail > /tmp/espinfo/retailfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/retailfind
RETAILSYTEMCOUNT=$(cat /tmp/espinfo/retailfind | wc -l)
if [ $RETAILSYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasretailsystem
else
echo "no" > /tmp/espinfo/hasretailsystem
fi
rm -rf /tmp/espinfo/retailfind

cat /u/esp/*/espapps.tab | grep spa > /tmp/espinfo/spafind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/spafind
SPASYTEMCOUNT=$(cat /tmp/espinfo/spafind | wc -l)
if [ $SPASYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasspasystem
else
echo "no" > /tmp/espinfo/hasspasystem
fi
rm -rf /tmp/espinfo/spafind

cat /u/esp/*/espapps.tab | grep leis > /tmp/espinfo/leisfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/leisfind
LEISSYTEMCOUNT=$(cat /tmp/espinfo/leisfind | wc -l)
if [ $LEISSYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasleissystem
else
echo "no" > /tmp/espinfo/hasleissystem
fi
rm -rf /tmp/espinfo/leisfind

cat /u/esp/*/espapps.tab | grep bar > /tmp/espinfo/barfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/barfind
BARSYTEMCOUNT=$(cat /tmp/espinfo/barfind | wc -l)
if [ $BARSYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasbarsystem
else
echo "no" > /tmp/espinfo/hasbarsystem
fi
rm -rf /tmp/espinfo/barfind

cat /u/esp/*/espapps.tab | grep admin > /tmp/espinfo/adminfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/adminfind
ADMINSYTEMCOUNT=$(cat /tmp/espinfo/adminfind | wc -l)
if [ $ADMINSYTEMCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasadminsystem
else
echo "no" > /tmp/espinfo/hasadminsystem
fi
rm -rf /tmp/espinfo/adminfind

find /u -name wserverr.log -exec grep -H 'Fuzzy' {} \; > /tmp/espinfo/recentaserverrfuzzy
ASERVERRFUZZY=$(cat /tmp/espinfo/recentaserverrfuzzy | grep "Fuzzy" | wc -l)
if [ $ASERVERRFUZZY -ge 1 ]
then
echo "yes" > /tmp/espinfo/accesscontrolanpr
else
echo "no" > /tmp/espinfo/accesscontrolanpr
fi
rm -rf /tmp/espinfo/recentaserverrfuzzy

find /u -name systems.tab -exec grep -H 'Interface=Salto' {} \; > /tmp/espinfo/saltofind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/saltofind
SALTOCOUNT=$(cat /tmp/espinfo/saltofind | wc -l)
if [ $SALTOCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hassalto
else
echo "no" > /tmp/espinfo/hassalto
fi
rm -rf /tmp/espinfo/saltofind

find /u/gui -name esp.log -mtime -30 -exec grep -H 'Inet Connection on 60010' {} \; > /tmp/espinfo/retentionfind
RETENTIONFIND=$(cat /tmp/espinfo/retentionfind | wc -l)
if [ $RETENTIONFIND -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasretention
else
echo "no" > /tmp/espinfo/hasretention
fi
rm -rf /tmp/espinfo/retentionfind

find /u -name systems.tab -exec grep -H 'CASHSCAN' {} \; > /tmp/espinfo/cctvfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/cctvfind
CCTVCOUNT=$(cat /tmp/espinfo/cctvfind | wc -l)
if [ $CCTVCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasrcctv
else
echo "no" > /tmp/espinfo/hasrcctv
fi
rm -rf /tmp/espinfo/cctvfind





find /u -name systems.tab -exec grep -H 'POSTCODE A' {} \; > /tmp/espinfo/postcodefind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/postcodefind
POSTCODEFINDCOUNT=$(cat /tmp/espinfo/postcodefind | wc -l)
POSTCODEFINDCOUNT2=$(find /opt -name "pcplus.lic" -mtime -365 | wc -l)
if [ $POSTCODEFINDCOUNT -ge 1 ] && [ $POSTCODEFINDCOUNT2 -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasafdpostcode
else
echo "no" > /tmp/espinfo/hasafdpostcode
fi
rm -rf /tmp/espinfo/postcodefind

find /u -name systems.tab -exec grep -H 'BankFinder=A' {} \; > /tmp/espinfo/bankfinderfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/bankfinderfind
BANKFINDERINDCOUNT=$(cat /tmp/espinfo/bankfinderfind | wc -l)
BANKFINDERINDCOUNT2=$(find /opt -name "afdbank.lic" -mtime -365 | wc -l)
if [ $BANKFINDERINDCOUNT -ge 1 ] && [ $BANKFINDERINDCOUNT2 -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasafdbankfinder
else
echo "no" > /tmp/espinfo/hasafdbankfinder
fi
rm -rf /tmp/espinfo/bankfinderfind

find /u -name efterr*.log -exec grep "Log Off From Ocius Sentinel" {} \; > /tmp/espinfo/hasverifonefind
VERIFONECOUNT=$(cat /tmp/espinfo/hasverifonefind | grep "Log Off From Ocius Sentinel" | wc -l)
if [ $VERIFONECOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasverifone
else
echo "no" > /tmp/espinfo/hasverifone
fi
rm -rf /tmp/espinfo/hasverifonefind

find /u -name systems.tab -exec grep "BOOK_POINTS" '{}' \; > /tmp/espinfo/bookpointsfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/bookpointsfind
BOOKPOINTSFINDCOUNT=$(cat /tmp/espinfo/bookpointsfind | wc -l)
if [ $BOOKPOINTSFINDCOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasbookpoints
else
echo "no" > /tmp/espinfo/hasbookpoints
fi
rm -rf /tmp/espinfo/bookpointsfind

find /u -name systems.tab -exec grep "PICTURES" '{}' \; > /tmp/espinfo/picturesfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/picturesfind
PICTURESFINDCOUNT=$(cat /tmp/espinfo/picturesfind | wc -l)
if [ $PICTURESFINDCOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/haspictures
else
echo "no" > /tmp/espinfo/haspictures
fi
rm -rf /tmp/espinfo/picturesfind

find /u -name mggroup.tab -type f -size +2c > /tmp/espinfo/mggroupfind
SESSMANGFIND=$(cat /tmp/espinfo/mggroupfind | wc -l)
if [ $SESSMANGFIND -ge 1 ]
then
echo "yes" > /tmp/espinfo/hassessionmangement
else
echo "no" > /tmp/espinfo/hassessionmangement
fi

# find these files greater than 2 bytes (i.e: have content)
find /u -name discmap.tab -type f -size +2c > /tmp/espinfo/discmapfind
find /u -name disctype.tab -type f -size +2c > /tmp/espinfo/disctypefind
DISCMAPCOUNT=$(cat /tmp/espinfo/discmapfind | wc -l)
DISCTYPECOUNT=$(cat /tmp/espinfo/disctypefind | wc -l)
if [ $DISCMAPCOUNT -ge 1 ] && [ $DISCTYPECOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/haslevysystem
else
echo "no" > /tmp/espinfo/haslevysystem
fi
rm -rf /tmp/espinfo/discmapfind
rm -rf /tmp/espinfo/disctypefind

# find these files greater than 2 bytes (i.e: have content)
find /u -name packtype.tab -type f -size +2c > /tmp/espinfo/packtypefind
find /u -name packgrp.tab -type f -size +2c > /tmp/espinfo/packgrpfind
PACKTYPECOUNT=$(cat /tmp/espinfo/packtypefind | wc -l)
PACKGROUPCOUNT=$(cat /tmp/espinfo/packgrpfind | wc -l)
if [ $PACKTYPECOUNT -ge 1 ] && [ $PACKGROUPCOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hascoursepackages
else
echo "no" > /tmp/espinfo/hascoursepackages
fi
rm -rf /tmp/espinfo/packtypefind
rm -rf /tmp/espinfo/packgrpfind

# find these files greater than 2 bytes (i.e: have content)
find /u -name pointmnu.tab -type f -size +2c > /tmp/espinfo/pointmnufind
POINTMNUCOUNT=$(cat /tmp/espinfo/pointmnufind | wc -l)
if [ $POINTMNUCOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasloyaltyschemes
else
echo "no" > /tmp/espinfo/hasloyaltyschemes
fi
rm -rf /tmp/espinfo/pointmnufind

find /u -name systems.tab -exec grep "Interface=Vingcard" '{}' \; > /tmp/espinfo/cardinterfacesystemfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/cardinterfacesystemfind
CARDINTERFACECOUNT=$(cat /tmp/espinfo/cardinterfacesystemfind | wc -l)
if [ $CARDINTERFACECOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hascardinterface
else
echo "no" > /tmp/espinfo/hascardinterface
fi
rm -rf /tmp/espinfo/cardinterfacesystemfind



find /u -name systems.tab -exec grep "INTEGRATION" '{}' \; > /tmp/espinfo/integrationfind
find /u -name systems.tab -exec grep "BatchType" '{}' \; > /tmp/espinfo/batchtypefind
sed -i '/#/d' /tmp/espinfo/integrationfind
sed -i '/#/d' /tmp/espinfo/batchtypefind
INTEGRATIONCOUNT=$(cat /tmp/espinfo/integrationfind | wc -l)
BATCHTYPECOUNT=$(cat /tmp/espinfo/batchtypefind | wc -l)
if [ $INTEGRATIONCOUNT -ge 1 ] && [ $BATCHTYPECOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasaccountsintegration
else 
echo "no" > /tmp/espinfo/hasaccountsintegration
fi 
rm -rf /tmp/espinfo/integrationfind
rm -rf /tmp/espinfo/batchtypefind

find /u -name exgroup.tab -exec grep "PlayGolf" '{}' \; > /tmp/espinfo/playmoregolffind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/playmoregolffind
PLAYMOREGOLDFIND=$(cat /tmp/espinfo/playmoregolffind | wc -l)
if [ $PLAYMOREGOLDFIND -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasplaymoregolf
else
echo "no" > /tmp/espinfo/hasplaymoregolf
fi
rm -rf /tmp/espinfo/playmoregolffind


find /u -name systems.tab -exec grep "TOPERAPMS" '{}' \; > /tmp/espinfo/operapmsfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/operapmsfind
REVENUEPOSTINGINTERFACECOUNT=$(cat /tmp/espinfo/operapmsfind | wc -l)
if [ $REVENUEPOSTINGINTERFACECOUNT -ge 1 ]
then
echo "yes" > /tmp/espinfo/hasoperapms
else
echo "no" > /tmp/espinfo/hasoperapms
fi
rm -rf /tmp/espinfo/hasoperapms


find /u -name systems.tab -exec grep -H 'TTIGERPMS' {} \; > /tmp/espinfo/guestconnecttigerfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/guestconnecttigerfind
GUESTCONNECTTIGERCOUNT=$(cat /tmp/espinfo/guestconnecttigerfind | wc -l)
if [ $GUESTCONNECTTIGERCOUNT -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasguestconnecttiger
else
echo "no" > /tmp/espinfo/hasguestconnecttiger
fi
rm -rf /tmp/espinfo/guestconnecttigerfind


find /u -name systems.tab -exec grep -H 'TAGILYSYSPMS' {} \; > /tmp/espinfo/agilysysfind
# Remove disabled hashed out items from find
sed -i '/#/d' /tmp/espinfo/agilysysfind
EXTERNALPMSFIND=$(cat /tmp/espinfo/agilysysfind | wc -l)
if [ $EXTERNALPMSFIND -ge 1 ]
then 
echo "yes" > /tmp/espinfo/hasagilysis
else
echo "no" > /tmp/espinfo/hasagilysis
fi
rm -rf /tmp/espinfo/hasagilysis

ZEBRALICENCECOUNT=$(whoui listterms | grep ZEBRA | wc -l)
echo $ZEBRALICENCECOUNT > /tmp/espinfo/noofzebralicences

# items in which no one has, has yet to be deceloped or not currenrlty possible to aduit
echo "n/a" > /tmp/espinfo/hashandicapping
echo "n/a" > /tmp/espinfo/hastrackman
echo "n/a" > /tmp/espinfo/hascoursesachievements
echo "n/a" > /tmp/espinfo/noofposlicences
echo "n/a" > /tmp/espinfo/thirdpartyserver
echo "n/a" > /tmp/espinfo/servergeolocation

echo "n/a" > /tmp/espinfo/noofp400devices
echo "n/a" > /tmp/espinfo/noofvm240devices


################################
## COMPILE ALL COLLECTED INFO ##
################################

cd /tmp/espinfo
#/usr/bin/paste hostname dateofinfo scriptver multisite syslastused runtime bsmsl64 bsmsl64size bsmsl64date bsmsrh8 bsmsrh8size bsmsrh8date bsmsrh5 bsmsrh5size bsmsrh5date pos5date pos6date pos7date espclientver espclientsize espclientdate espsite espsitesize eftver useseft nooflicences elitego linux64ver linux32ver afdlookup monit serverman serverpro serverserial serversku hddsize ramsize srvuptime backuptype cpumodel cpucores osversion osmajorver osarch kernelversion serverpackages softwareraid serverfilesystem sysage hostip hostgateway internetupload internetdownload publicipis publicipregion publicipcity publicipcountry publiciporganisation publicipgeoloc export comms accessctl httpservice custmind phones range odbc > espsysteminfo.txt
/usr/bin/paste hostname dateofinfo scriptver multisite syslastused runtime bsmsl64 bsmsl64size bsmsl64date bsmsrh8 bsmsrh8size bsmsrh8date bsmsrh5 bsmsrh5size bsmsrh5date pos5date pos6date pos7date espclientver espclientsize espclientdate espsite espsitesize eftver useseft nooflicences elitego linux64ver linux32ver afdlookup monit thirdpartyserver servergeolocation serverman serverpro serverserial serversku hddsize ramsize srvuptime backuptype cpumodel cpucores osversion osmajorver osarch kernelversion serverpackages softwareraid serverfilesystem sysage hostip hostgateway internetupload internetdownload publicipis publicipregion publicipcity publicipcountry publiciporganisation publicipgeoloc export comms custmind odbc hasadminsystem hasretailsystem hasbarsystem haspmssystem hasleissystem hasspasystem hashandicapping range hascustomerassets hasevents haspostables hasfbonline hasdirectdebit hasbookpoints haspictures hassessionmangement haslevysystem hascoursepackages hascoursesachievements haslocationbookings accesscontrolactivity accesscontrolmonitors haskiosk hasloyaltyschemes noofzebralicences noofposlicences hasverifone noofp400devices noofvm240devices hascardinterface hasafdpostcode hasafdbankfinder hasretention accessctl accesscontrolanpr hassalto hastrackman hasaccountsintegration hasplaymoregolf hasremotepricecheck httpservice hasrcctv hasoperapms hasguestconnecttiger hasagilysis phones > espsysteminfo


mkdir complete
HOSTNAMEIS=$(hostname)
mv espsysteminfo.txt $HOSTNAMEIS-espsysteminfo.txt
mv $HOSTNAMEIS-espsysteminfo.txt /tmp/espinfo/complete

##############################
## UPLOAD THE INFO VIA SFTP ##
##############################

SSHPASS_HOST=sysinfo.esp-support.co.uk
sed -i '/[$SSHPASS_HOST]/d' /root/.ssh/known_hosts

export SSHPASS=$(cat /u/gui/scripts/sysinfopass)
sshpass -e sftp -o StrictHostKeyChecking=no -oBatchMode=no -b - "$(cat /u/gui/scripts/sysinfouser)"@sysinfo.esp-support.co.uk << !
   lcd /tmp/espinfo/complete
   cd "$(cat /u/gui/scripts/sysinfouser)"
   put *.txt
   ls
   bye
!

# On remote server, files get uploaded to: 
# /sftpusers/chroot/[SITE ID HERE]/
